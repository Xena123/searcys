function debounce(func, wait, immediate) {
    var timeout;
    return function() {
        var context = this, args = arguments;
        var later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
    };
}

(function() {
    var throttle = function(type, name, obj) {
        obj = obj || window;
        var running = false;
        var func = function() {
            if (running) {
                return;
            }
            running = true;
            requestAnimationFrame(function() {
                obj.dispatchEvent(new CustomEvent(name));
                running = false;
            });
        };
        obj.addEventListener(type, func);
    };
    throttle("resize", "optimizedResize");
})();

function toggle(obj) {
    var el = document.getElementById(obj);
    if (el.style.display != "none") {
        el.style.display = "none";
    } else {
        el.style.display = "";
    }
}

function toggleNav() {
    var body = document.body;
    if (body.classList.contains("is-menu-open")) {
        body.classList.remove("is-menu-open");
    } else {
        body.classList.add("is-menu-open");
    }
}

var headShrink = debounce(function() {
    var body = document.body;
    var scrollDist = window.pageYOffset;
    if (scrollDist > 250 && !body.classList.contains("is-shrunk")) {
        body.classList.add("is-shrunk");
    } else if (scrollDist <= 250 && body.classList.contains("is-shrunk")) {
        body.classList.remove("is-shrunk");
    }
}, 10);

function isotopeNoLayout() {
    Isotope.Item.prototype._create = function() {
        this.id = this.layout.itemGUID++;
        this._transn = {
            ingProperties: {},
            clean: {},
            onEnd: {}
        };
        this.sortData = {};
    };
    Isotope.Item.prototype.layoutPosition = function() {
        this.emitEvent("layout", [ this ]);
    };
    Isotope.prototype.arrange = function(opts) {
        this.option(opts);
        this._getIsInstant();
        this.filteredItems = this._filter(this.items);
        this._isLayoutInited = true;
    };
    Isotope.LayoutMode.create("none");
}

function startIsotope() {
    if (document.getElementById("isotope")) {
        isotopeNoLayout();
        var isotopeButton = document.querySelectorAll(".isofilter__btn");
        var iso = $("#isotope").isotope({
            itemSelector: ".isotope-bx",
            layoutMode: "none"
        });
        for (var i = 0; i < isotopeButton.length; i++) {
            isotopeButton[i].addEventListener("click", function(event) {
                var filterValue = $(this).attr("data-filter");
                iso.isotope({
                    filter: filterValue
                });
                $(".isofilter__btn").removeClass("is-active");
                $(this).addClass("is-active");
            }, false);
        }
    }
}

function searchFocus() {
    var target = this.querySelector("input");
    target.focus();
}

function filterNews() {
    var input = document.getElementById("news-search");
    var searchValue = input.value.toUpperCase();
    var articles = document.querySelectorAll(".isotope-bx");
    if (searchValue != "") {
        for (var i = 0; i < articles.length; i++) {
            var searchIn = articles[i].querySelector(".bx__ttl");
            if (searchIn.innerHTML.toUpperCase().indexOf(searchValue) > -1) {
                articles[i].classList.remove("is-filtered");
            } else {
                articles[i].classList.add("is-filtered");
            }
        }
    } else {
        for (var i = 0; i < articles.length; i++) {
            articles[i].classList.remove("is-filtered");
        }
    }
}

function initContactMap() {
    var styledMapType = new google.maps.StyledMapType([ {
        featureType: "poi.business",
        elementType: "labels",
        stylers: [ {
            visibility: "off"
        } ]
    } ], {
        name: "Styled Map"
    });
    var uluru = {
        lat: 51.520659,
        lng: -.107279
    };
    var map = new google.maps.Map(document.getElementById("mapContact"), {
        zoom: 17,
        center: uluru,
        mapTypeControlOptions: {
            mapTypeIds: [ "roadmap", "satellite", "hybrid", "terrain", "styled_map" ]
        }
    });
    var marker = new google.maps.Marker({
        position: uluru,
        map: map
    });
    map.mapTypes.set("styled_map", styledMapType);
    map.setMapTypeId("styled_map");
}

(function($) {
    function new_map($el) {
        var $markers = $el.find(".marker");
        var args = {
            zoom: 16,
            center: new google.maps.LatLng(0, 0),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map($el[0], args);
        map.markers = [];
        $markers.each(function() {
            add_marker($(this), map);
        });
        center_map(map);
        return map;
    }
    function add_marker($marker, map) {
        var latlng = new google.maps.LatLng($marker.attr("data-lat"), $marker.attr("data-lng"));
        var marker = new google.maps.Marker({
            position: latlng,
            map: map
        });
        map.markers.push(marker);
        if ($marker.html()) {
            var infowindow = new google.maps.InfoWindow({
                content: $marker.html()
            });
            google.maps.event.addListener(marker, "click", function() {
                infowindow.open(map, marker);
            });
        }
    }
    function center_map(map) {
        var bounds = new google.maps.LatLngBounds();
        $.each(map.markers, function(i, marker) {
            var latlng = new google.maps.LatLng(marker.position.lat(), marker.position.lng());
            bounds.extend(latlng);
        });
        if (map.markers.length == 1) {
            map.setCenter(bounds.getCenter());
            map.setZoom(16);
        } else {
            map.fitBounds(bounds);
        }
    }
    var map = null;
    $(document).ready(function() {
        $(".acf-map").each(function() {
            map = new_map($(this));
        });
    });
})(jQuery);

window.onload = function() {
    "use strict";
    var supports = !!document.querySelector && !!window.addEventListener;
    if (!supports) {
        return;
    }
    document.body.className += " has-modern-js";
    var targetId = document.getElementById("targetId");
    if (document.getElementById(targetId)) {}
    if (document.getElementById(targetId)) {}
    var burger = document.getElementById("js-menu-toggle");
    burger.addEventListener("click", checkMobileNav);
    function checkMobileNav() {
        $(".l-header__nav").removeClass("js-remove");
        if ($("body").hasClass("is-menu-open")) {
            $("body").removeClass("is-menu-open");
            $("body").addClass("is-menu-closed");
        } else {
            $("body").removeClass("is-menu-closed");
            $("body").addClass("is-menu-open");
        }
    }
    var header = document.getElementById("js-header");
    window.onscroll = function() {
        Headerscroll();
    };
    function Headerscroll() {
        if (document.body.scrollTop > 150 || document.documentElement.scrollTop > 150) {
            document.getElementById("js-header").className = "l-header is-scrolled";
        } else {
            document.getElementById("js-header").className = "l-header";
        }
    }
};

$(document).ready(function() {
    if (document.getElementById("slider")) {
        $(".l-slider").slick({
            dots: true,
            infinite: true,
            speed: 300,
            slidesToShow: 1
        });
    }
    $("#venue-search select").select2({
        width: "resolve",
        dropdownAutoWidth: true
    });
    $(".venue-filter, .restaurant-filter, .event-type-filter, .event-location-filter").on("select2:open", function() {
        $(".select2-search--dropdown .select2-search__field").attr("placeholder", "Type to filter");
    });
    $(".venue-filter, .restaurant-filter, .event-type-filter, .event-location-filter").on("select2:opening", function() {
        setTimeout(function() {
            $(".select2-dropdown").css("opacity", "1");
        }, 100);
    });
    $(".venue-filter, .restaurant-filter, .event-type-filter, .event-location-filter").on("select2:closing", function(e) {
        $(".select2-dropdown").css("opacity", "0");
    });
    $(".venue-filter, .restaurant-filter, .event-type-filter, .event-location-filter").on("select2:close", function(e) {
        $(".select2-dropdown").css("opacity", "");
    });
    $(".venue-filter").change(function() {
        $(location).attr("href", $(this).val());
    });
    $(".restaurant-filter").change(function() {
        $(location).attr("href", $(this).val());
    });
    $(".event-type-filter").change(function() {
        var currentDomain = document.location.origin;
        if ($(this).val() !== "0") {
            $(".reset-filter.type").removeClass("hidden");
            if ($(".event-location-filter").val() !== "0") {
                $(".filter-url").val(currentDomain + "/" + $(this).val() + "-in-" + $(".event-location-filter").val());
            } else {
                $(".filter-url").val(currentDomain + "/venue-event/" + $(this).val());
            }
        } else {
            $(".reset-filter.type").addClass("hidden");
        }
    });
    $(".event-location-filter").change(function() {
        var currentDomain = document.location.origin;
        if ($(this).val() !== "0") {
            $(".reset-filter.location").removeClass("hidden");
            if ($(".event-type-filter").val() !== "0") {
                $(".filter-url").val(currentDomain + "/" + $(".event-type-filter").val() + "-in-" + $(this).val());
            } else {
                $(".filter-url").val(currentDomain + "/venue-location/" + $(this).val());
            }
        } else {
            $(".reset-filter.location").addClass("hidden");
        }
    });
    $(".event-type-filter, .event-location-filter").change(function() {
        showVenues();
        handleSubmit(false);
        var location = $(".event-location-filter"), type = $(".event-type-filter");
        if (type.val() !== "0") {
            hideVenues();
            $(".event-type-filter, .event-location-filter").closest("div").removeClass("disabled");
        }
        if (location.val() !== "0") {
            hideVenues();
            $(".event-type-filter, .event-location-filter").closest("div").removeClass("disabled");
        }
    });
    function hideVenues() {
        $(".venue-filter, .event-type-filter, .restaurant-filter, .event-location-filter").closest("div").addClass("disabled");
        handleSubmit(true);
    }
    function showVenues() {
        $(".venue-filter, .event-type-filter, .restaurant-filter, .event-location-filter").closest("div").removeClass("disabled");
    }
    function handleSubmit(disabled) {
        if (disabled === true) {
            $(".search-button").removeClass("disabled");
        } else {
            $(".search-button").addClass("disabled");
        }
    }
    $("#venue-search form").submit(function(e) {
        e.preventDefault();
        var $url = $(".filter-url").val();
        $(location).attr("href", $url);
    });
    $(".reset-filter.type").click(function(e) {
        e.preventDefault();
        $(".event-type-filter").val(0).trigger("change");
        $(this).addClass("hidden");
        console.log("Remove filter");
    });
    $(".reset-filter.location").click(function(e) {
        e.preventDefault();
        $(".event-location-filter").val(0).trigger("change");
        $(this).addClass("hidden");
    });
});